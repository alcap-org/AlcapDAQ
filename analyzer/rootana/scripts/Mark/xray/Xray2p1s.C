void Xray2p1s(const char *target) {
	TFile *fData = new TFile(Form("%s/%s.root", getenv("R15b_DATA"), target), "READ");
	TTree *tree = (TTree *)fData->Get("tree");
	Double_t t1, e1, timeToPrevTME, timeToNextTME;
	TString * channel = new TString("");
	tree->SetBranchAddress("timeToPrevTME", &timeToPrevTME);
	tree->SetBranchAddress("timeToNextTME", &timeToNextTME);
	tree->SetBranchAddress("e1", &e1);
	tree->SetBranchAddress("t1", &t1);
	tree->SetBranchAddress("channel", &channel);

	Int_t min = 334, max = 358;
	Int_t bins = max-min;
	TH1D *hGeHiGain = new TH1D("hGeHiGain", "GeHiGain;;Counts / 1 keV", bins, min, max);

	TH1D *hGeHiGainRes = new TH1D("hGeHiGainRes", "GeHiGain Residual;E[keV];#frac{Entries-Fit}{Entries}[%]", bins, min, max);
	for(Long64_t i=0; i < tree->GetEntries(); ++i) {
		tree->GetEntry(i);
		if(timeToPrevTME < 10e3 || timeToNextTME < 10e3) continue;
		if(abs(t1)>10e3) continue;
		if(e1 < min || e1 > max) continue;
		if(channel->Contains("GeHiGain") ) {
			hGeHiGain->Fill(e1);
		}
	}
	TF1 *fit = new TF1("fit", "[0]*TMath::Exp(-0.5 * ((x-[1])/[2])^2) + [3]*TMath::Exp(-0.5 * ((x-[4])/[2])^2) + TMath::Exp([5]+[6]*x)", min, max);
	fit->SetParName(0, "Al const.");
	fit->SetParName(1, "Al mean");
	fit->SetParName(2, "Sigma");
	fit->SetParName(3, "Pb const.");
	fit->SetParName(4, "Pb mean");
	fit->SetParName(5, "Bkg. const.");
	fit->SetParName(6, "Bkg. slope");

	fit->SetParameter(0,  3.59928e+04);
	fit->SetParameter(1,  3.45373e+02);
	fit->SetParameter(2,  9.95034e-01);
	fit->SetParameter(3,  7.27854e+03);
	fit->SetParameter(4,  3.49581e+02);
	fit->SetParameter(5,  1.35165e+01);
	fit->SetParameter(6, -1.51580e-02);
	fit->SetParLimits(1, 340, 348);
	fit->SetParLimits(2, 0, 2);
	fit->SetParLimits(4, 348, 352);

	gStyle->SetOptFit(1);
	gStyle->SetOptStat(1000000001); //only name of histogram

	//GeHiGain fit
	fit->SetLineColor(kBlue);
	hGeHiGain->Fit("fit", "SR+");
	Double_t areaGeHiGain = TMath::Sqrt(2*3.142) * fit->GetParameter(0) * fit->GetParameter(2);
	Double_t areaErrGeHiGain = TMath::Sqrt(2*TMath::Pi() ) * areaGeHiGain * ( fit->GetParError(0)/fit->GetParameter(0) + fit->GetParError(2)/fit->GetParameter(2) );
	for(int i=1; i<hGeHiGain->GetSize()- 1; ++i) {
		Double_t res = 100 * (hGeHiGain->GetBinContent(i) - fit->Eval(min+i-0.5) )/hGeHiGain->GetBinContent(i);
		hGeHiGainRes->SetBinContent(i-1, res);
	}

	Double_t xrayIntensity = 0.798, xrayIntensityErr = 0.008;
	Double_t geHiEfficiency = 6.63e-4, geEfficiencyErr = 0.1e-4;
	Double_t finalErrGeHiGain = TMath::Power((areaErrGeHiGain/areaGeHiGain), 2) + TMath::Power((xrayIntensityErr/xrayIntensity), 2) + TMath::Power((geEfficiencyErr/geHiEfficiency), 2);
	finalErrGeHiGain = areaGeHiGain/xrayIntensity/geHiEfficiency * TMath::Sqrt(finalErrGeHiGain);

	TF1 *result = new TF1("fit", "[0]*TMath::Exp(-0.5 * ((x-[1])/[2])^2)", min, max);
	result->SetParameter(0, fit->GetParameter(0) );
	result->SetParameter(1, fit->GetParameter(1) );
	result->SetParameter(2, fit->GetParameter(2) );
	result->SetLineColor(kBlue);
	result->SetLineStyle(kDashed);

	TCanvas *c = new TCanvas("c", "c");
	TPad *p1 = new TPad("p1", "p1",0,0.3,1,1, kWhite, 0, 0);
	p1->SetBottomMargin(0.05);
	p1->Draw();
	TPad *p2 = new TPad("p2", "p2",0,0.0,1,0.3 , kWhite, 0, 0);
	p2->SetTopMargin(0.00001);
	p2->SetBottomMargin(0.2);
	p2->Draw();

	p1->cd();
	hGeHiGain->Draw("E");
	result->Draw("SAME");
	hGeHiGain->SetMarkerStyle(kCircle);
	hGeHiGain->GetYaxis()->SetRangeUser(1, hGeHiGain->GetMaximum() * 1.1);
	hGeHiGain->SetLineColor(kBlue);
	hGeHiGain->GetXaxis()->SetLabelSize(0);
	hGeHiGain->GetYaxis()->SetMaxDigits(3);
	hGeHiGain->GetYaxis()->SetTitleSize(.05);
	hGeHiGain->GetYaxis()->SetTitleOffset(.8);
	hGeHiGain->GetYaxis()->SetLabelFont(63);
	hGeHiGain->GetYaxis()->SetLabelSize(16);

	TLegend *legend = new TLegend(.6, .5, .87, .87, "#bf{AlCap} #it{#muAl 2p #rightarrow 1s}");
	legend->AddEntry((TObject*)0, "N_{#mu} = 2.28 #times 10^{8}", "");
	legend->AddEntry(hGeHiGain, "Ge data", "E");
	legend->AddEntry(fit, "Total fit", "L");
	legend->AddEntry(result, Form("N_{stop} = %.2f(%.0f) #times 10^{8}", areaGeHiGain/xrayIntensity/geHiEfficiency/1e8, finalErrGeHiGain/1e6), "L");
	legend->Draw("SAME");

	p2->cd();
	p2->SetGridx();
	p2->SetGridy();
	hGeHiGainRes->Draw();
	hGeHiGainRes->GetXaxis()->SetLabelFont(63);
	hGeHiGainRes->GetXaxis()->SetLabelSize(15);
	hGeHiGainRes->GetXaxis()->SetTitleSize(.1);
	hGeHiGainRes->GetXaxis()->SetTitleOffset(.4);
	hGeHiGainRes->GetXaxis()->SetTitle("[keV]");

	hGeHiGainRes->SetFillColor(38);
	hGeHiGainRes->SetLineColor(kWhite);
	hGeHiGainRes->GetYaxis()->SetNdivisions(10, 2, 0);
	hGeHiGainRes->GetYaxis()->SetLabelFont(63);
	hGeHiGainRes->GetYaxis()->SetLabelSize(16);
	hGeHiGainRes->GetYaxis()->SetTitleSize(.1);
	hGeHiGainRes->GetYaxis()->SetTitleOffset(.4);
	hGeHiGainRes->GetYaxis()->CenterTitle();
	c->cd();

	const char *FigsDir = getenv("R15b_OUT");
	c->SaveAs(Form("%s/AlCapData_Al50Dataset_2p1sXray.pdf", FigsDir) );
}
